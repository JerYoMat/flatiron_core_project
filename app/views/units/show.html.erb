
<%= image_tag("#{@unit.image_path}", :alt => "#{@unit.title}") %><br>
<h1 data-unit_id="<%=@unit.id%>"><%=@unit.title%></h1>
<div class="row">
  <div class="col-md-4">
  <ul id="topics_container" class="list-group">
  </ul>
  </div>


  <div id="tip_holder" class="col-md-8 card">
    <div class="place_for_tips">
    </div>
  </div>
</div>



<script>
$(document).ready(function(){
  let unitId = $("h1").attr("data-unit_id");
  $.getJSON(`${unitId}/topics`,"", getTopicsAndTipsForUnit);
});

const topicList = [];
function getTopicsAndTipsForUnit(data) {
  createTopicObjects(data)
  addClickListeners();
}

function createTopicObjects(jsonTopics) {
  jsonTopics.forEach((item) => {
    const topic = new Topic(item);
    topicList.push(topic);
    $("#topics_container").append(topic.formatTopic); 
  });
}

function addClickListeners() {
 $("li").each(function() {
   $(this).click(setActiveClass);
   $(this).click(loadTips);
});
}

function loadTips() {
  const topicId = this.getAttribute("data-topic");
  const selectedTopic = topicList.filter( t => t.id == topicId
  )[0]
  $(".place_for_tips").empty()
  selectedTopic.tips.forEach((tip)=>{
    $(".place_for_tips").append(tip.formatTip); 
  })
  
   
}

function setActiveClass() {
    $("li").removeClass("active");
    $(this).addClass("active");
}



class Topic {
  
  constructor(item) {
    this.id = item.id;
    this.title = item.title;
    this.courseOrder = item.course_order;
    this.tips = this.convertTips(item)
    this.formatTopic = this.formatTopic.bind(this)
  }
  formatTopic() {
    const bullet = document.createElement('li');
    bullet.className = "list-group-item"
    bullet.innerHTML = this.title;
    bullet.setAttribute('data-topic', this.id) 
    return bullet;
  }
  convertTips(item) {
    const tipArray = []
    item.tips.forEach((ti) => {
    const tip = new Tip(ti)
    tipArray.push(tip)
  })
  return tipArray
}

}
class Tip {
  constructor(jsonTip) {
    this.id = jsonTip.id;
    this.title = jsonTip.title;
    this.link = jsonTip.link;
    this.resource_type = jsonTip.resource_type;
    this.time_requirement = jsonTip.time_requirement;
    this.formatTip = this.formatTip.bind(this);
  }
  formatTip(){
    return `<div class='card'>
      <div class='card-body'>
        <h5 class='card-title'>${this.title}</h5>
        <p>${this.link}</p>
        <p>${this.resource_type}</p>
        <p>${this.time_requirement}</p>
        
      </div>
    </div>`
  }
}




</script>

<style>
   
    img{ 
        display: block;
        margin-top: 5%;
        margin-right: auto;
        margin-left: auto;
        width: 30%;
        max-width: 150px;
    }
    div#tip_holder {border: 1px solid rgba(0, 0, 0, 0.125);
                    padding: 0;}

    

  
</style>